//@version=6
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š TEMPLATE BÃSICO DE INDICADOR PINESCRIPT v6
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 
// ğŸ“ DescripciÃ³n: Template base para crear indicadores personalizados
// ğŸ‘¨â€ğŸ’» Autor: TradingView Community
// ğŸ“… VersiÃ³n: 1.0
// ğŸ”— Repositorio: https://github.com/tdtrader76/pinescriptv2
// 
// ğŸ¯ CaracterÃ­sticas:
// âœ… Estructura organizada y comentada
// âœ… ParÃ¡metros configurables por el usuario
// âœ… ValidaciÃ³n de datos de entrada
// âœ… VisualizaciÃ³n profesional
// âœ… Sistema de alertas incluido
// âœ… Optimizado para rendimiento
// 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

indicator("MI INDICADOR PERSONALIZADO", shorttitle="MIC", overlay=true)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‹ CONFIGURACIÃ“N Y PARÃMETROS DE USUARIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// === GRUPO: CONFIGURACIÃ“N PRINCIPAL ===
periodo_principal = input.int(20, title="PerÃ­odo Principal", minval=1, maxval=500, 
                             tooltip="NÃºmero de perÃ­odos para el cÃ¡lculo principal", group="ğŸ“Š ConfiguraciÃ³n Principal")

fuente_datos = input.source(close, title="Fuente de Datos", 
                           tooltip="Precio usado para los cÃ¡lculos (close, open, high, low, etc.)", group="ğŸ“Š ConfiguraciÃ³n Principal")

tipo_calculo = input.string("SMA", title="Tipo de CÃ¡lculo", 
                           options=["SMA", "EMA", "WMA", "VWMA"], 
                           tooltip="Tipo de media mÃ³vil a calcular", group="ğŸ“Š ConfiguraciÃ³n Principal")

// === GRUPO: CONFIGURACIÃ“N VISUAL ===
mostrar_linea_principal = input.bool(true, title="Mostrar LÃ­nea Principal", 
                                    tooltip="Activar/desactivar la lÃ­nea principal del indicador", group="ğŸ¨ VisualizaciÃ³n")

color_linea_principal = input.color(color.blue, title="Color LÃ­nea Principal", 
                                   tooltip="Color de la lÃ­nea principal", group="ğŸ¨ VisualizaciÃ³n")

grosor_linea = input.int(2, title="Grosor de LÃ­nea", minval=1, maxval=5, 
                        tooltip="Grosor de la lÃ­nea principal (1-5)", group="ğŸ¨ VisualizaciÃ³n")

mostrar_area = input.bool(false, title="Mostrar Ãrea de Relleno", 
                         tooltip="Rellenar Ã¡rea entre la lÃ­nea y el precio", group="ğŸ¨ VisualizaciÃ³n")

transparencia_area = input.int(85, title="Transparencia del Ãrea", minval=0, maxval=100, 
                              tooltip="Nivel de transparencia (0=opaco, 100=transparente)", group="ğŸ¨ VisualizaciÃ³n")

// === GRUPO: SEÃ‘ALES Y ALERTAS ===
activar_seÃ±ales = input.bool(true, title="Activar SeÃ±ales", 
                            tooltip="Mostrar seÃ±ales de compra/venta", group="ğŸ“¢ SeÃ±ales y Alertas")

activar_alertas = input.bool(false, title="Activar Alertas", 
                            tooltip="Enviar alertas cuando se generen seÃ±ales", group="ğŸ“¢ SeÃ±ales y Alertas")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” VALIDACIÃ“N DE PARÃMETROS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FunciÃ³n para validar parÃ¡metros de entrada
validarParametros() =>
    var string mensaje_error = ""
    
    // Validar perÃ­odo
    if periodo_principal < 1 or periodo_principal > 500
        mensaje_error := "âŒ Error: El perÃ­odo debe estar entre 1 y 500"
        runtime.error(mensaje_error)
    
    // Validar fuente de datos
    if na(fuente_datos)
        mensaje_error := "âŒ Error: Fuente de datos no vÃ¡lida"
        runtime.error(mensaje_error)
    
    true

// Ejecutar validaciÃ³n
validacion_ok = validarParametros()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§® FUNCIONES AUXILIARES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FunciÃ³n para calcular diferentes tipos de medias mÃ³viles
calcularMediaMovil(src, longitud, tipo) =>
    switch tipo
        "SMA" => ta.sma(src, longitud)
        "EMA" => ta.ema(src, longitud)
        "WMA" => ta.wma(src, longitud)
        "VWMA" => ta.vwma(src, longitud)
        => ta.sma(src, longitud)  // Valor por defecto

// FunciÃ³n para detectar cruces alcistas
esCruceAlcista(serie1, serie2) =>
    ta.crossover(serie1, serie2)

// FunciÃ³n para detectar cruces bajistas
esCruceBajista(serie1, serie2) =>
    ta.crossunder(serie1, serie2)

// FunciÃ³n para verificar si una vela es alcista
esVelaAlcista() =>
    close > open

// FunciÃ³n para verificar si una vela es bajista
esVelaBajista() =>
    close < open

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š CÃLCULOS PRINCIPALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ¡lculo del indicador principal
indicador_principal = calcularMediaMovil(fuente_datos, periodo_principal, tipo_calculo)

// CÃ¡lculo de lÃ­nea de seÃ±al (media mÃ³vil mÃ¡s rÃ¡pida del indicador principal)
periodo_seÃ±al = math.max(1, math.round(periodo_principal * 0.45))  // ~45% del perÃ­odo principal
linea_seÃ±al = ta.ema(indicador_principal, periodo_seÃ±al)

// CÃ¡lculo de la distancia entre precio y indicador (para anÃ¡lisis)
distancia_precio = ((fuente_datos - indicador_principal) / indicador_principal) * 100

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ DETECCIÃ“N DE SEÃ‘ALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SeÃ±ales de trading
seÃ±al_compra_principal = esCruceAlcista(fuente_datos, indicador_principal)
seÃ±al_venta_principal = esCruceBajista(fuente_datos, indicador_principal)

// SeÃ±ales secundarias (cruce con lÃ­nea de seÃ±al)
seÃ±al_compra_secundaria = esCruceAlcista(indicador_principal, linea_seÃ±al)
seÃ±al_venta_secundaria = esCruceBajista(indicador_principal, linea_seÃ±al)

// Filtros adicionales para mejorar la calidad de las seÃ±ales
filtro_volumen = volume > ta.sma(volume, 20)  // Volumen por encima de la media
filtro_tendencia = indicador_principal > indicador_principal[10]  // Tendencia alcista
filtro_volatilidad = ta.atr(14) > ta.sma(ta.atr(14), 20)  // Alta volatilidad

// SeÃ±ales filtradas (mÃ¡s confiables)
seÃ±al_compra_filtrada = seÃ±al_compra_principal and filtro_volumen and filtro_tendencia
seÃ±al_venta_filtrada = seÃ±al_venta_principal and filtro_volumen and not filtro_tendencia

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ VISUALIZACIÃ“N Y PLOTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Plot de la lÃ­nea principal
linea_principal_plot = plot(mostrar_linea_principal ? indicador_principal : na, 
                           title="LÃ­nea Principal", 
                           color=color_linea_principal, 
                           linewidth=grosor_linea)

// Plot de la lÃ­nea de seÃ±al (mÃ¡s sutil)
linea_seÃ±al_plot = plot(mostrar_linea_principal ? linea_seÃ±al : na, 
                       title="LÃ­nea de SeÃ±al", 
                       color=color.new(color.orange, 30), 
                       linewidth=1)

// Plot del precio para referencia
precio_plot = plot(fuente_datos, 
                  title="Precio", 
                  color=color.new(color.gray, 70), 
                  linewidth=1, 
                  display=display.none)  // Invisible, solo para fill

// Ãrea de relleno entre precio e indicador
fill(precio_plot, linea_principal_plot, 
     color=mostrar_area ? color.new(color_linea_principal, transparencia_area) : na
