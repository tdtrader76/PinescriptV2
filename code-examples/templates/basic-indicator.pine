//@version=6
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š TEMPLATE BÃSICO DE INDICADOR PINESCRIPT v6
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 
// ğŸ“ DescripciÃ³n: Template base para crear indicadores personalizados
// ğŸ‘¨â€ğŸ’» Autor: TradingView Community
// ğŸ“… VersiÃ³n: 1.0
// ğŸ”— Repositorio: https://github.com/tdtrader76/pinescriptv2
// 
// ğŸ¯ CaracterÃ­sticas:
// âœ… Estructura organizada y comentada
// âœ… ParÃ¡metros configurables por el usuario
// âœ… ValidaciÃ³n de datos de entrada
// âœ… VisualizaciÃ³n profesional
// âœ… Sistema de alertas incluido
// âœ… Optimizado para rendimiento
// 
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

indicator("MI INDICADOR PERSONALIZADO", shorttitle="MIC", overlay=true)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“‹ CONFIGURACIÃ“N Y PARÃMETROS DE USUARIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// === GRUPO: CONFIGURACIÃ“N PRINCIPAL ===
periodo_principal = input.int(20, title="PerÃ­odo Principal", minval=1, maxval=500, 
                             tooltip="NÃºmero de perÃ­odos para el cÃ¡lculo principal", group="ğŸ“Š ConfiguraciÃ³n Principal")

fuente_datos = input.source(close, title="Fuente de Datos", 
                           tooltip="Precio usado para los cÃ¡lculos (close, open, high, low, etc.)", group="ğŸ“Š ConfiguraciÃ³n Principal")

tipo_calculo = input.string("SMA", title="Tipo de CÃ¡lculo", 
                           options=["SMA", "EMA", "WMA", "VWMA"], 
                           tooltip="Tipo de media mÃ³vil a calcular", group="ğŸ“Š ConfiguraciÃ³n Principal")

// === GRUPO: CONFIGURACIÃ“N VISUAL ===
mostrar_linea_principal = input.bool(true, title="Mostrar LÃ­nea Principal", 
                                    tooltip="Activar/desactivar la lÃ­nea principal del indicador", group="ğŸ¨ VisualizaciÃ³n")

color_linea_principal = input.color(color.blue, title="Color LÃ­nea Principal", 
                                   tooltip="Color de la lÃ­nea principal", group="ğŸ¨ VisualizaciÃ³n")

grosor_linea = input.int(2, title="Grosor de LÃ­nea", minval=1, maxval=5, 
                        tooltip="Grosor de la lÃ­nea principal (1-5)", group="ğŸ¨ VisualizaciÃ³n")

mostrar_area = input.bool(false, title="Mostrar Ãrea de Relleno", 
                         tooltip="Rellenar Ã¡rea entre la lÃ­nea y el precio", group="ğŸ¨ VisualizaciÃ³n")

transparencia_area = input.int(85, title="Transparencia del Ãrea", minval=0, maxval=100, 
                              tooltip="Nivel de transparencia (0=opaco, 100=transparente)", group="ğŸ¨ VisualizaciÃ³n")

// === GRUPO: SEÃ‘ALES Y ALERTAS ===
activar_seÃ±ales = input.bool(true, title="Activar SeÃ±ales", 
                            tooltip="Mostrar seÃ±ales de compra/venta", group="ğŸ“¢ SeÃ±ales y Alertas")

activar_alertas = input.bool(false, title="Activar Alertas", 
                            tooltip="Enviar alertas cuando se generen seÃ±ales", group="ğŸ“¢ SeÃ±ales y Alertas")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” VALIDACIÃ“N DE PARÃMETROS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FunciÃ³n para validar parÃ¡metros de entrada
validarParametros() =>
    var string mensaje_error = ""
    
    // Validar perÃ­odo
    if periodo_principal < 1 or periodo_principal > 500
        mensaje_error := "âŒ Error: El perÃ­odo debe estar entre 1 y 500"
        runtime.error(mensaje_error)
    
    // Validar fuente de datos
    if na(fuente_datos)
        mensaje_error := "âŒ Error: Fuente de datos no vÃ¡lida"
        runtime.error(mensaje_error)
    
    true

// Ejecutar validaciÃ³n
validacion_ok = validarParametros()

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§® FUNCIONES AUXILIARES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FunciÃ³n para calcular diferentes tipos de medias mÃ³viles
calcularMediaMovil(src, longitud, tipo) =>
    switch tipo
        "SMA" => ta.sma(src, longitud)
        "EMA" => ta.ema(src, longitud)
        "WMA" => ta.wma(src, longitud)
        "VWMA" => ta.vwma(src, longitud)
        => ta.sma(src, longitud)  // Valor por defecto

// FunciÃ³n para detectar cruces alcistas
esCruceAlcista(serie1, serie2) =>
    ta.crossover(serie1, serie2)

// FunciÃ³n para detectar cruces bajistas
esCruceBajista(serie1, serie2) =>
    ta.crossunder(serie1, serie2)

// FunciÃ³n para verificar si una vela es alcista
esVelaAlcista() =>
    close > open

// FunciÃ³n para verificar si una vela es bajista
esVelaBajista() =>
    close < open

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š CÃLCULOS PRINCIPALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// CÃ¡lculo del indicador principal
indicador_principal = calcularMediaMovil(fuente_datos, periodo_principal, tipo_calculo)

// CÃ¡lculo de lÃ­nea de seÃ±al (media mÃ³vil mÃ¡s rÃ¡pida del indicador principal)
periodo_seÃ±al = math.max(1, math.round(periodo_principal * 0.45))  // ~45% del perÃ­odo principal
linea_seÃ±al = ta.ema(indicador_principal, periodo_seÃ±al)

// CÃ¡lculo de la distancia entre precio y indicador (para anÃ¡lisis)
distancia_precio = ((fuente_datos - indicador_principal) / indicador_principal) * 100

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ DETECCIÃ“N DE SEÃ‘ALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SeÃ±ales de trading
seÃ±al_compra_principal = esCruceAlcista(fuente_datos, indicador_principal)
seÃ±al_venta_principal = esCruceBajista(fuente_datos, indicador_principal)

// SeÃ±ales secundarias (cruce con lÃ­nea de seÃ±al)
seÃ±al_compra_secundaria = esCruceAlcista(indicador_principal, linea_seÃ±al)
seÃ±al_venta_secundaria = esCruceBajista(indicador_principal, linea_seÃ±al)

// Filtros adicionales para mejorar la calidad de las seÃ±ales
filtro_volumen = volume > ta.sma(volume, 20)  // Volumen por encima de la media
filtro_tendencia = indicador_principal > indicador_principal[10]  // Tendencia alcista
filtro_volatilidad = ta.atr(14) > ta.sma(ta.atr(14), 20)  // Alta volatilidad

// SeÃ±ales filtradas (mÃ¡s confiables)
seÃ±al_compra_filtrada = seÃ±al_compra_principal and filtro_volumen and filtro_tendencia
seÃ±al_venta_filtrada = seÃ±al_venta_principal and filtro_volumen and not filtro_tendencia

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¨ VISUALIZACIÃ“N Y PLOTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Plot de la lÃ­nea principal
linea_principal_plot = plot(mostrar_linea_principal ? indicador_principal : na, 
                           title="LÃ­nea Principal", 
                           color=color_linea_principal, 
                           linewidth=grosor_linea)

// Plot de la lÃ­nea de seÃ±al (mÃ¡s sutil)
linea_seÃ±al_plot = plot(mostrar_linea_principal ? linea_seÃ±al : na, 
                       title="LÃ­nea de SeÃ±al", 
                       color=color.new(color.orange, 30), 
                       linewidth=1)

// Plot del precio para referencia
precio_plot = plot(fuente_datos, 
                  title="Precio", 
                  color=color.new(color.gray, 70), 
                  linewidth=1, 
                  display=display.none)  // Invisible, solo para fill

// Ãrea de relleno entre precio e indicador
fill(precio_plot, linea_principal_plot, 
     color=mostrar_area ? color.new(color_linea_principal, transparencia_area) : na,
     title="Ãrea de Relleno")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ VISUALIZACIÃ“N DE SEÃ‘ALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// SeÃ±ales de compra (triÃ¡ngulos verdes hacia arriba)
plotshape(activar_seÃ±ales and seÃ±al_compra_filtrada, 
          title="SeÃ±al de Compra", 
          location=location.belowbar, 
          color=color.green, 
          style=shape.triangleup, 
          size=size.small,
          text="COMPRA")

// SeÃ±ales de venta (triÃ¡ngulos rojos hacia abajo)
plotshape(activar_seÃ±ales and seÃ±al_venta_filtrada, 
          title="SeÃ±al de Venta", 
          location=location.abovebar, 
          color=color.red, 
          style=shape.triangledown, 
          size=size.small,
          text="VENTA")

// SeÃ±ales secundarias (cÃ­rculos mÃ¡s pequeÃ±os)
plotshape(activar_seÃ±ales and seÃ±al_compra_secundaria and not seÃ±al_compra_filtrada, 
          title="SeÃ±al Secundaria Compra", 
          location=location.belowbar, 
          color=color.new(color.green, 50), 
          style=shape.circle, 
          size=size.tiny)

plotshape(activar_seÃ±ales and seÃ±al_venta_secundaria and not seÃ±al_venta_filtrada, 
          title="SeÃ±al Secundaria Venta", 
          location=location.abovebar, 
          color=color.new(color.red, 50), 
          style=shape.circle, 
          size=size.tiny)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“Š INFORMACIÃ“N EN TABLA (OPCIONAL)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Crear tabla de informaciÃ³n (esquina superior derecha)
var table tabla_info = table.new(position.top_right, 2, 6, bgcolor=color.white, border_width=1)

// Actualizar tabla en la Ãºltima barra
if barstate.islast
    // TÃ­tulo
    table.cell(tabla_info, 0, 0, "INDICADOR", text_color=color.black, text_size=size.small, bgcolor=color.gray)
    table.cell(tabla_info, 1, 0, "VALOR", text_color=color.black, text_size=size.small, bgcolor=color.gray)
    
    // Valores actuales
    table.cell(tabla_info, 0, 1, "Precio Actual", text_color=color.black, text_size=size.small)
    table.cell(tabla_info, 1, 1, str.tostring(fuente_datos, "#.##"), text_color=color.black, text_size=size.small)
    
    table.cell(tabla_info, 0, 2, tipo_calculo + "(" + str.tostring(periodo_principal) + ")", text_color=color.black, text_size=size.small)
    table.cell(tabla_info, 1, 2, str.tostring(indicador_principal, "#.##"), text_color=color.black, text_size=size.small)
    
    table.cell(tabla_info, 0, 3, "LÃ­nea SeÃ±al", text_color=color.black, text_size=size.small)
    table.cell(tabla_info, 1, 3, str.tostring(linea_seÃ±al, "#.##"), text_color=color.black, text_size=size.small)
    
    table.cell(tabla_info, 0, 4, "Distancia %", text_color=color.black, text_size=size.small)
    table.cell(tabla_info, 1, 4, str.tostring(distancia_precio, "#.##") + "%", 
               text_color=distancia_precio > 0 ? color.green : color.red, text_size=size.small)
    
    // Estado de tendencia
    estado_tendencia = indicador_principal > indicador_principal[1] ? "ALCISTA â¬†" : "BAJISTA â¬‡"
    color_tendencia = indicador_principal > indicador_principal[1] ? color.green : color.red
    table.cell(tabla_info, 0, 5, "Tendencia", text_color=color.black, text_size=size.small)
    table.cell(tabla_info, 1, 5, estado_tendencia, text_color=color_tendencia, text_size=size.small)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¢ SISTEMA DE ALERTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Alertas principales (seÃ±ales filtradas)
alertcondition(activar_alertas and seÃ±al_compra_filtrada, 
               title="ğŸŸ¢ SeÃ±al de Compra Filtrada", 
               message="ğŸŸ¢ COMPRA en {{ticker}} | Precio: {{close}} | Indicador: " + str.tostring(indicador_principal, "#.##") + " | Timeframe: {{interval}}")

alertcondition(activar_alertas and seÃ±al_venta_filtrada, 
               title="ğŸ”´ SeÃ±al de Venta Filtrada", 
               message="ğŸ”´ VENTA en {{ticker}} | Precio: {{close}} | Indicador: " + str.tostring(indicador_principal, "#.##") + " | Timeframe: {{interval}}")

// Alertas secundarias
alertcondition(activar_alertas and seÃ±al_compra_secundaria, 
               title="ğŸŸ¡ SeÃ±al Secundaria Compra", 
               message="ğŸŸ¡ SeÃ±al Secundaria COMPRA en {{ticker}} | Precio: {{close}} | Timeframe: {{interval}}")

alertcondition(activar_alertas and seÃ±al_venta_secundaria, 
               title="ğŸŸ¡ SeÃ±al Secundaria Venta", 
               message="ğŸŸ¡ SeÃ±al Secundaria VENTA en {{ticker}} | Precio: {{close}} | Timeframe: {{interval}}")

// Alerta de cambio de tendencia
cambio_tendencia_alcista = indicador_principal > indicador_principal[1] and indicador_principal[1] <= indicador_principal[2]
cambio_tendencia_bajista = indicador_principal < indicador_principal[1] and indicador_principal[1] >= indicador_principal[2]

alertcondition(activar_alertas and cambio_tendencia_alcista, 
               title="ğŸ“ˆ Cambio a Tendencia Alcista", 
               message="ğŸ“ˆ Cambio a TENDENCIA ALCISTA en {{ticker}} | Precio: {{close}} | Timeframe: {{interval}}")

alertcondition(activar_alertas and cambio_tendencia_bajista, 
               title="ğŸ“‰ Cambio a Tendencia Bajista", 
               message="ğŸ“‰ Cambio a TENDENCIA BAJISTA en {{ticker}} | Precio: {{close}} | Timeframe: {{interval}}")

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ FUNCIONES DE UTILIDAD ADICIONALES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// FunciÃ³n para exportar datos (para anÃ¡lisis externos)
exportarDatos() =>
    datos = map.new<string, float>()
    map.put(datos, "precio", fuente_datos)
    map.put(datos, "indicador_principal", indicador_principal)
    map.put(datos, "linea_seÃ±al", linea_seÃ±al)
    map.put(datos, "distancia_porcentaje", distancia_precio)
    map.put(datos, "volumen", volume)
    datos

// FunciÃ³n para calcular estadÃ­sticas
calcularEstadisticas(serie, periodo) =>
    media = ta.sma(serie, periodo)
    desviacion = ta.stdev(serie, periodo)
    minimo = ta.lowest(serie, periodo)
    maximo = ta.highest(serie, periodo)
    [media, desviacion, minimo, maximo]

// Calcular estadÃ­sticas del indicador (Ãºltimas 50 barras)
[media_indicador, std_indicador, min_indicador, max_indicador] = calcularEstadisticas(indicador_principal, 50)

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“ COMENTARIOS FINALES Y NOTAS DE USO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ğŸ“‹ INSTRUCCIONES DE USO:
// 1. Ajusta el "PerÃ­odo Principal" segÃºn tu estilo de trading (valores tÃ­picos: 14, 20, 50)
// 2. Selecciona la "Fuente de Datos" apropiada (close es la mÃ¡s comÃºn)
// 3. Experimenta con diferentes "Tipos de CÃ¡lculo" para ver cuÃ¡l funciona mejor
// 4. Activa las seÃ±ales para ver puntos de entrada/salida potenciales
// 5. Usa las alertas para recibir notificaciones en tiempo real

// âš ï¸ ADVERTENCIAS:
// - Este es un template educativo, no constituye asesoramiento financiero
// - Siempre realiza backtesting antes de usar en trading real
// - Las seÃ±ales pueden generar falsas alarmas en mercados laterales
// - Combina con otros indicadores para confirmar seÃ±ales

// ğŸ”„ PERSONALIZACIÃ“N:
// - Modifica los cÃ¡lculos en la secciÃ³n "CÃLCULOS PRINCIPALES"
// - Ajusta los colores y estilos en "VISUALIZACIÃ“N"
// - AÃ±ade nuevos parÃ¡metros en "CONFIGURACIÃ“N Y PARÃMETROS"
// - Crea nuevas condiciones de seÃ±ales en "DETECCIÃ“N DE SEÃ‘ALES"

// ğŸ“Š MÃ‰TRICAS DE RENDIMIENTO:
// - El indicador se recalcula en cada barra nueva
// - Optimizado para usar mÃ­nimos recursos computacionales
// - Compatible con todos los timeframes de TradingView
// - Funciona con cualquier instrumento financiero

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIN DEL TEMPLATE - Â¡PERSONALIZA SEGÃšN TUS NECESIDADES!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
